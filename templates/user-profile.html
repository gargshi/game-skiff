{% extends 'base.html' %}
{% load static %}

{% block title %}User Profile{% endblock %}

{% block content %}
{% include 'navbar.html' %}
{% include 'messages.html' %}
<section class="profile-section">
	<div class="side-bar">
		<div class="profile-info">
			<div class="profile-pic"></div>
			<div class="profile-name">{{ user.username }}</div>
		</div>
		<div class="side-bar-menu">
			<div class="side-bar-item" id="profile-item">Profile</div>
			<div class="side-bar-item" id="settings-item">Settings</div>
			<div class="side-bar-item" id="games-item">Games</div>
		</div>
	</div>
	<div class="profile-content">
		<div class="detail" id="profile-detail">
			<h2 class="detail-title">Profile</h2>
			<hr>
			<div class="profile-info-area">
				<p>Welcome, {{ user.username }} !! This is your profile page.</p>
				<p>Name: {{ profile.name }}</p>
				{% if user.email == None or user.email == '' %}
					<p>Email: <i>Not set</i></p>
				{% else %}
					<p>Email: {{ user.email }}</p>
				{% endif %}
			</div>
			<button class="cardd-btn primary" id="edit-profile-btn">Edit</button>
			<br>
			<br>
			<div class="profile-info-area-edit">
			</div>
		</div>
		<div class="detail" id="settings-detail">
			<h2 class="detail-title">Settings</h2>
			<hr>
			<p>Change password</p>
			<p>Change email</p>
		</div>
		<div class="detail" id="games-detail">
			<h2 class="detail-title">Games</h2>
			<hr>
			<div class="tabs">
				<div class="tab-buttons">
					<button class="tab-btn active" data-tab="tab1">Your Game Library</button>
					<button class="tab-btn" data-tab="tab2">Created Games</button>
				</div>

				<div class="tab-content active" id="tab1">
					<h4>Your game library</h4>
					<div class="games-flex-grid" id="played-games-list"></div>
				</div>

				<div class="tab-content" id="tab2">
					<h4>Created games</h4>
					<div class="games-flex-grid" id="created-games-list"></div>
				</div>
			</div>
		</div>
	</div>

</section>


{% endblock %}

{% block other_scripts %}
<script>

	const profileName = document.querySelector('.profile-name');
	glitchReveal(profileName, profileName.textContent, 1000);

	sideBarMenu = document.querySelector('.side-bar-menu');

	

	


	let games = [
		{
			"name": "Game 1",
			"title": "Driftbreak: Neon Outrun",
			"image": "https://picsum.photos/300/180?random=11",
			"genre": "Racing",
			"rating": 4.4,
			"year": 2024,
			"description": "Race through neon cities where every turn rewrites the future."
		},
		{
			"name": "Game 2",
			"title": "Astral Vanguard",
			"image": "https://picsum.photos/300/180?random=12",
			"genre": "Sci-Fi Shooter",
			"rating": 4.7,
			"year": 2025,
			"description": "Lead humanity's last elite squad beyond the veil of known space."
		},
		{
			"name": "Game 3",
			"title": "Shadowgate Rituals",
			"image": "https://picsum.photos/300/180?random=13",
			"genre": "Dark Fantasy",
			"rating": 4.3,
			"year": 2023,
			"description": "Unseal cursed gateways and battle ancient spirits of the forgotten realm."
		},
		{
			"name": "Game 4",
			"title": "Frontier Harvest",
			"image": "https://picsum.photos/300/180?random=14",
			"genre": "Colony Builder",
			"rating": 4.6,
			"year": 2024,
			"description": "Grow, build, and defend your settlement on a strange new world."
		},
		{
			"name": "Game 5",
			"title": "Riftsea Chronicles",
			"image": "https://picsum.photos/300/180?random=15",
			"genre": "Action RPG",
			"rating": 4.5,
			"year": 2023,
			"description": "Dive into a fractured ocean world ruled by leviathans and lost magic. Survive the chaos. Be the hero. Be the hero."
		},
		{
			"name": "Game 6",
			"title": "Chrome Saboteur",
			"image": "https://picsum.photos/300/180?random=16",
			"genre": "Stealth / Cyberpunk",
			"rating": 4.1,
			"year": 2024,
			"description": "Hack, infiltrate, and dismantle megacities from the underground."
		},
		{
			"name": "Game 7",
			"title": "Mythborn Valley",
			"image": "https://picsum.photos/300/180?random=17",
			"genre": "Adventure",
			"rating": 4.8,
			"year": 2025,
			"description": "Uncover the myths that shaped a forgotten kingdom hidden in nature."
		},
		{
			"name": "Game 8",
			"title": "Iron Horizon: Sky Legion",
			"image": "https://picsum.photos/300/180?random=18",
			"genre": "Aerial Combat",
			"rating": 4.2,
			"year": 2023,
			"description": "Command customizable airships in the ultimate sky-warfare saga."
		},
		{
			"name": "Game 9",
			"title": "Echoes of Meridian",
			"image": "https://picsum.photos/300/180?random=19",
			"genre": "Story-Driven RPG",
			"rating": 4.9,
			"year": 2025,
			"description": "Rewrite fate as you explore timelines that collide and reshape reality."
		},
		{
			"name": "Game 10",
			"title": "Outpost Solstice",
			"image": "https://picsum.photos/300/180?random=20",
			"genre": "Survival",
			"rating": 4.4,
			"year": 2024,
			"description": "Survive endless winter on a polar outpost where daylight never returns."
		}
	];

	let userPlayedGames = [
		games[0],
		games[1],
		games[2],
		games[3]
	];

	let userCreatedGames = [
		games[4],
		games[5],
		games[6],
		games[7],
		games[8],
		games[9]
	]


	const gameList = document.getElementById('played-games-list');
	userCreatedGames.forEach(game => {
		card = createGameCard({
			"title": game.title,
			"genre": game.genre,
			"rating": game.rating,
			"year": game.year,
			"description": game.description
		});
		gameList.appendChild(card);
	});

	const playedGameList = document.getElementById('created-games-list');
	userPlayedGames.forEach(game => {
		card = createGameCard({
			"title": game.title,
			"genre": game.genre,
			"rating": game.rating,
			"year": game.year,
			"description": game.description
		});
		playedGameList.appendChild(card);
	});

	const detailSections = {
		"profile-item": document.getElementById("profile-detail"),
		"settings-item": document.getElementById("settings-detail"),
		"games-item": document.getElementById("games-detail")
	};
	sideBarMenu.querySelectorAll('.side-bar-item').forEach((item) => {
		item.addEventListener('click', () => {
			sideBarMenu.querySelectorAll('.side-bar-item').forEach((item) => {
				item.classList.remove('active');
			})
			item.classList.add('active');
			const targetDetail = detailSections[item.id];
			if (targetDetail) {
				targetDetail.scrollIntoView({
					behavior: "smooth",
					block: "start"
				});
			}
			//blink border of detail title to emphasize it
			const detailTitle = targetDetail.querySelector('.detail-title');
			glitchReveal(detailTitle, detailTitle.textContent);
		})
	});

	const editProfileBtn = document.getElementById('edit-profile-btn');
	let formHidden = true;
	editProfileBtn.addEventListener('click', () => {
		const profileInfoArea = document.querySelector('.profile-info-area');
		const profileInfoAreaEdit = document.querySelector('.profile-info-area-edit');

		formHTML = `
			<form method="post" class="profile-form" action="{% url 'bkeditprofile' %}">
				{% csrf_token %}				
				<div class="form-group">
					<label for="name">Name</label>
					<input type="text" id="name" name="name" value="{{ profile.name }}" required>
				</div>				
				<button type="submit" class="cardd-btn primary">Save</button>
			</form>
		`;

		formHidden = !formHidden;
		if (!formHidden) {
			profileInfoAreaEdit.innerHTML = formHTML;
			profileInfoArea.classList.add('hidden');
			editProfileBtn.innerHTML = "Cancel Editing";
			editProfileBtn.classList.add('btn-danger');
		}
		else {
			profileInfoAreaEdit.innerHTML = "";
			profileInfoArea.classList.remove('hidden');
			editProfileBtn.innerHTML = "Edit";
			editProfileBtn.classList.remove('btn-danger');
		}
	});



</script>
<script>
	document.querySelectorAll(".tab-btn").forEach(btn => {
		btn.addEventListener("click", () => {

			// remove active tab button
			document.querySelectorAll(".tab-btn")
				.forEach(b => b.classList.remove("active"));

			// activate clicked button
			btn.classList.add("active");

			// hide all content
			document.querySelectorAll(".tab-content")
				.forEach(tab => tab.classList.remove("active"));

			// show targeted content
			document.getElementById(btn.dataset.tab)
				.classList.add("active");
		});
	});

</script>
{% endblock %}